<app-alert [(visible)]="alertData.display" [extraData]="alertData.extraData" [type]="alertData.typ"
  [hasConfirm]="alertData.isConfirm" (action)="callbackAlert($event)" [content]="alertData.content"
  [title]="alertData.title"></app-alert>

<div class="portlet-content-container">
  <div class="portlet-body">
    <div *ngIf="display">
      <form *ngIf="detail" [formGroup]="comForm">

        <!-- <div *ngIf="detail"> -->
        <!-- caso dettaglio richiesta i-esima-->
        <div class="row" style="padding-top: 1.4em">
          <div class="col-lg-2 col-md-4 col-sm-12">
            <label for="motivazione">
              {{"richiestePostTrasmissione.motivazione" | translate}}
            </label>
          </div>
          <div class="col-lg-10 col-md-8">
            <!--<input class="form-control" 
                    formControlName="oggetto"
                    [ngClass]="{'is-invalid': inviato && comForm.controls.oggetto.errors}" 
                    maxlength="{{const.MAX_LEN_OGGETTO_EMAIL}}"/>-->
            <input class="form-control" formControlName="motivazione" maxlength="{{ 1000 }}" />
            <div class="invalid-feedback" *ngIf="false">
              {{ "generic.required" | translate }}
            </div>
          </div>
        </div>

        <!-- Allegati -->
        <div class="row" style="padding-top: 1em">
          <div class="col-md-12">
            <label for="allegaFile">{{
              "documentazione.allegaFile" | translate
              }}</label>
            <p-fileUpload *ngIf="!disableButtons" chooseLabel="{{ 'generic.carica' | translate }}"
              (onSelect)="allegaFile($event)" [showCancelButton]="false" cancelLabel="Annulla"
              [showUploadButton]="false">
            </p-fileUpload>
            <div class="tableContainerCustom">
              <p-table [value]="fileArray">
                <ng-template pTemplate="header">
                  <tr>
                    <th>Tipo File</th>
                    <th>Nome file</th>
                    <th>
                      {{ "fascicolo.tableAllegati.checksum" | translate }}
                    </th>
                    <!-- <th>Data ultima modifica</th> -->
                    <th></th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-file let-i="rowIndex">
                  <tr>
                    <td>{{ descrizioneFile(file) }}</td>
                    <td>{{ file.nome }}</td>
                    <!-- <td>{{ nomeFile(file) }}</td> -->
                    <td>{{ checksumFile(file) }}</td>
                    <!-- <td>{{file.lastModified|date: 'dd/MM/yyyy'}}</td> -->
                    <td>
                      <button class="bttn btn btn-success bttn-table" *ngIf="file.id"
                        (click)="download(file.id, file.nome)">
                        <fa-icon icon="download"></fa-icon>
                      </button>
                      <button *ngIf="!disableButtons" class="bttn btn btn-danger bttn-table"
                        (click)="cancellaAllegato(i)" [disabled]="disableEditAllegato">
                        <fa-icon icon="trash"></fa-icon>
                      </button>
                    </td>
                  </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage" let-columns>
                  <tr>
                    <td [attr.colspan]="4">Nessun file inserito</td>
                  </tr>
                </ng-template>
              </p-table>
            </div>
          </div>
        </div>
        <!-- <div class="row" style="padding-top: 2em;" *ngIf="showButtonBar"> -->
        <div class="row" style="padding-top: 2em">
          <div class="col-md-12 text-center">
            <button *ngIf="!disableButtons" class="bttn btn btn-primary" (click)="sendData('Bozza')"
              [disabled]="disableEdit">
              Salva in bozza
            </button>
            <button *ngIf="!disableButtons" class="bttn btn btn-primary" (click)="trasmetti()"
              [disabled]="disableEdit">
              Invia
            </button>
            <button class="bttn btn btn-primary" (click)="cancel()">
              {{disableButtons ? "Chiudi" : "Annulla"}}
            </button>
          </div>
        </div>
        <!-- </div> -->
      </form>
      <div *ngIf="!detail">
        <!-- caso tabella-->
        <app-generic-table [items]="richiesteData" [totalItems]="itemsTotal" [header]="intestazioneTabella"
          (onInfo)="modificaBozza($event)" (onPaging)="cambioPagina($event)" (onEdit)="modificaBozza($event)"
          (onRemove)="eliminaBozza($event)" [disableInfoButton]="false" [disableEditButton]="false"
          [disableDeleteButton]="false" [disableSelectButton]="true" [customElement]="customElement" #tableRichieste
          [rowsPerPage]="pagSearch.rows">
        </app-generic-table>
        <ng-template #customElement>
          <!-- <div class="float-right containerBtnAggiuntivi dflex align-items-center mt-3"> -->
          <div class="dflex align-items-center" style="text-align: right">
            <div class="row nop justify-content-end" style="width: 100%">
              <div *ngIf="true" class="col-lg-auto col-md-4 col-sm-12">
                <button type="button" (click)="nuovaModifica()" class="btn bttn btn-primary">
                  {{ "richiestePostTrasmissione.nuovaModifica" | translate }}
                  <fa-icon icon="plus"></fa-icon>
                </button>
                <button type="button" (click)="nuovaCancellazione()" class="btn bttn btn-danger">
                  {{
                  "richiestePostTrasmissione.nuovaCancellazione" | translate
                  }}
                  <fa-icon icon="plus"></fa-icon>
                </button>
              </div>
            </div>
          </div>
        </ng-template>
      </div>
    </div>
  </div>
</div>