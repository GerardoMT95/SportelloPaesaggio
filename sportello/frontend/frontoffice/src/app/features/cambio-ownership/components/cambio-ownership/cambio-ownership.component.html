<app-alert [(visible)]="display" [extraData]="extraData" [type]="typ" [hasConfirm]="isConfirm"
    (action)="callback($event)" [content]="content" [title]="title"></app-alert>

<!-- FORM -->
<div class="container-fluid nop">
    <div class="portlet-content-container">
        <div class="col-md-12">
            <form [formGroup]="form" class="text-left">
                <p-tabView class="step" [activeIndex]="activeIndex">
                    <p-tabPanel>
                        <ng-template pTemplate="header">
                            <div class="intestazione">
                                {{'generic.ricerca'|translate}}
                            </div>
                        </ng-template>
                        <div class="row noml nomr">
                            <div class="col-md-12 col-sm-12">
                                <div class="form-group">
                                    <label>{{'cambioOwnership.codicePratica'|translate}} *</label>
                                    <app-text-field formControlName="codicePratica" name="codicePratica"
                                        [validation]="validazione" [errors]="form.controls.codicePratica.errors"
                                        [disabled]="checkSuperato"></app-text-field>
                                </div>
                            </div>
                        </div>
                        <div class="row noml nomr">
                            <div class="col-md-12 col-sm-12">
                                <div class="form-group">
                                    <label>{{'cambioOwnership.codiceFiscaleProponente'|translate}} *</label>
                                    <app-text-field formControlName="codiceFiscaleProponente"
                                        name="codiceFiscaleProponente" [validation]="validazione"
                                        [errors]="form.controls.codiceFiscaleProponente.errors" [uppercase]="true"
                                        [disabled]="checkSuperato"></app-text-field>
                                </div>
                            </div>
                        </div>
                        <div class="row noml nomr">
                            <div class="col-md-12 col-sm-12">
                                <div class="form-group">
                                    <label>{{'cambioOwnership.codiceSegreto'|translate}} *</label>
                                    <app-text-field formControlName="codiceSegreto" name="codiceSegreto"
                                        [validation]="validazione" [errors]="form.controls.codiceSegreto.errors"
                                        [disabled]="checkSuperato"></app-text-field>
                                </div>
                            </div>
                        </div>
                    </p-tabPanel>
                    <p-tabPanel *ngIf="checkSuperato">
                        <ng-template pTemplate="header">
                            <div class="intestazione">
                                {{'TAB_TITLE.DELEGATO'|translate}}
                            </div>
                        </ng-template>
                        <app-delegato [fascicolo]="fascicoloDettaglio" [mainForm]="form" [disabled]="false" [residenzaRequired]="false"
                            [soloLettura]="false" [delegato]="fascicoloDettaglio != null ? fascicoloDettaglio.delegatoPratica : null"
                             #delegatoTab></app-delegato>
                        <div class="row noml nomr" *ngIf="checkSuperato">
                            <!-- 
                            <div class="col-md-12" style="padding-bottom:10px"  *ngIf="!fileNameDelega || !fileNameDelega.length">
                                <label>{{'cambioOwnership.documentazione'|translate}} *</label>
                                <br/>
                                <button (click)="downloadTemplateDelega()" class="bttn btn btn-primary">
                                <fa-icon icon="download"></fa-icon>
                                {{'cambioOwnership.documentazioneModello' | translate}}
                                </button>
                                <br/>
                            </div>
                            -->
                            <div class="col-md-12 col-sm-12">
                                <label>{{'cambioOwnership.documentazione'|translate}} *</label>
                                <div class="form-group" *ngIf="!fileNameDelega || !fileNameDelega.length">
                                    <app-file-upload 
                                        (onAllega)="onUpload($event)" 
                                        fileLimit="1"
                                        [multiple]="false" 
                                        [invalidFileTypeMessageDetail]="invalidFileType" 
                                        [showCancelButton]="true"
                                        [mimeTypeForScansioni]="acceptedFiles">
                                    </app-file-upload>
                                </div>
                                <div class="form-group" *ngIf="fileNameDelega && fileNameDelega.length">
                                    <div class="col-md-12">
                                        <div class="full-width tableContainer">
                                            <table class="table table-hover table-striped">
                                                <thead>
                                                    <tr>
                                                        <th>{{'cambioOwnership.fileName'|translate}}</th>
                                                        <th>{{'cambioOwnership.fileHash'|translate}}</th>
                                                        <th style="width:100px">{{'cambioOwnership.azioni'|translate}}
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>{{fileNameDelega}}</td>
                                                        <td>{{hashDelega}}</td>
                                                        <td class="nowrap text-center">
                                                            <button type="button" (click)="downloadDelega()"
                                                                placement="top" container="body"
                                                                ngbTooltip="{{'generic.download'|translate}}"
                                                                class="bttn bttn-table btn btn-success">
                                                                <fa-icon icon="download"></fa-icon>
                                                            </button>
                                                            <button type="button" (click)="deleteDelega()"
                                                                placement="top" container="body"
                                                                ngbTooltip="{{'generic.eliminaAllegato'|translate}}"
                                                                class="bttn bttn-table btn btn-danger">
                                                                <fa-icon icon="trash"></fa-icon>
                                                            </button>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div class="row noml nomr" *ngIf="checkSuperato && needSollevamentoIncarico">
                         
                            <div class="col-md-12 col-sm-12">
                                <label>{{'cambioOwnership.sollevamentoIncarico'|translate}} *</label>
                                <div class="form-group" *ngIf="!fileNameSollevamento || !fileNameSollevamento.length">
                                    <app-file-upload 
                                        (onAllega)="onUploadSollevamento($event)" 
                                        fileLimit="1"
                                        [multiple]="false" 
                                        [invalidFileTypeMessageDetail]="invalidFileType" 
                                        [showCancelButton]="true"
                                        [mimeTypeForScansioni]="acceptedFiles">
                                    </app-file-upload>
                                </div>
                                <div class="form-group" *ngIf="fileNameSollevamento && fileNameSollevamento.length">
                                    <div class="col-md-12">
                                        <div class="full-width tableContainer">
                                            <table class="table table-hover table-striped">
                                                <thead>
                                                    <tr>
                                                        <th>{{'cambioOwnership.fileName'|translate}}</th>
                                                        <th>{{'cambioOwnership.fileHash'|translate}}</th>
                                                        <th style="width:100px">{{'cambioOwnership.azioni'|translate}}
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>{{fileNameSollevamento}}</td>
                                                        <td>{{hashSollevamento}}</td>
                                                        <td class="nowrap text-center">
                                                            <button type="button"
                                                                (click)="downloadSollevamentoIncarico()" placement="top"
                                                                container="body"
                                                                ngbTooltip="{{'generic.download'|translate}}"
                                                                class="bttn bttn-table btn btn-success">
                                                                <fa-icon icon="download"></fa-icon>
                                                            </button>
                                                            <button type="button" (click)="deleteSollevamento()"
                                                                placement="top" container="body"
                                                                ngbTooltip="{{'generic.eliminaAllegato'|translate}}"
                                                                class="bttn bttn-table btn btn-danger">
                                                                <fa-icon icon="trash"></fa-icon>
                                                            </button>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </p-tabPanel>
                </p-tabView>
            </form>
        </div>
    </div>
    <div class="text-center inner-pulsantiera">
        <div class="pulsantiera clearfix">
            <button *ngIf="!checkSuperato" type="button" (click)="ricerca()" class="bttn btn btn-primary">
                {{'generic.ricerca'|translate}}
                <fa-icon icon="search"></fa-icon>
            </button>
            <button *ngIf="checkSuperato" type="button" (click)="save()"
                class="bttn btn btn-primary">{{'generic.salva'|translate}}
                <fa-icon icon="save"></fa-icon>
            </button>
            <button
                *ngIf="checkSuperato && form.valid && fileNameDelega && fileNameDelega.length && (!needSollevamentoIncarico || (fileNameSollevamento && fileNameSollevamento.length))"
                type="button" (click)="trasmetti()" class="bttn btn btn-primary">{{'generic.subentra'|translate}}
                <fa-icon icon="arrow-right"></fa-icon>
            </button>
            <button type="button" (click)="resetForm()" class="bttn btn btn-primary">{{'generic.annulla'|translate}}
                <fa-icon icon="times"></fa-icon></button>
        </div>
    </div>
</div>